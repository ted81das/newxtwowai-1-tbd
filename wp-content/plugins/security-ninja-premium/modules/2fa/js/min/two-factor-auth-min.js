"use strict";jQuery(document).ready((function($){$("#generate-qr").length&&o();var e=$("#twofa-form-verify"),r=$("#twofa-code"),a=e.find("button");function o(){$("#generate-qr").prop("disabled",!0);var e=$(".qr-code .spinner");e.addClass("is-active"),$.ajax({url:two_factor_auth.ajaxurl,type:"GET",data:{action:"secnin_generate_qr_code",nonce:$('#secnin-gen-qr input[name="_wpnonce"]').val(),user_ip:$('#secnin-gen-qr input[name="user_ip"]').val(),user_agent:$('#secnin-gen-qr input[name="user_agent"]').val()},success:function(r){$("#generate-qr").prop("disabled",!1).removeClass("is-disabled"),e.removeClass("is-active"),$("#generate-qr").prop("disabled",!1).removeClass("is-disabled"),r.success?($("#qr-code-img-err").text(""),$("#qr-code-img").attr("src",r.data.qr_code)):$("#qr-code-img-err").replaceWith('<p class="errmsg">Error generating QR code. Please try again. Debug info: '+r.data.message+"</p>")},error:function(r){$("#generate-qr").prop("disabled",!1).removeClass("is-disabled"),e.removeClass("is-active"),$("#qr-code-img-err").html('<p class="errmsg">Error generating QR code. Please check your internet connection and try again. Status: '+r.status+", Response Text: "+r.responseText+"</p>")}})}r.on("input",(function(){a.prop("disabled",!this.checkValidity())})),$("#generate-qr").on("click",(function(e){e.preventDefault(),$("#generate-qr").prop("disabled",!0).addClass("is-disabled"),$("#qr-code-img-err").text(""),$("#qr-code-img").removeAttr("src"),o()})),$("#twofa-form-verify .button").on("click",(function(e){e.preventDefault();var r=$("#twofa-form-verify #twofa-code").val();/^\d{6}$/.test(r)?($("#twofa-verify-msg").html('<p class="okmsg">Checking code.</p>'),$("#twofa-form-verify .button").prop("disabled",!0),$("#twofa-form-verify #twofa-code").prop("disabled",!0),$.ajax({url:two_factor_auth.ajaxurl,type:"POST",data:{action:"secnin_verify_2fa_code",code:r,nonce:$('#twofa-form-verify input[name="_wpnonce"]').val(),user_ip:$('#twofa-form-verify input[name="user_ip"]').val(),user_agent:$('#twofa-form-verify input[name="user_agent"]').val()},success:function(e){if(e.success){$("#twofa-verify-msg").html('<p class="okmsg">Code OK. Redirecting.</p>');var r=new URL(window.location.href).searchParams.get("redirect_to");if(r)try{var a=new URL(r,window.location.origin);a.origin===window.location.origin?window.location.href=a.href:console.error("Invalid redirect URL")}catch(e){console.error("Invalid URL",e)}}else $("#twofa-form-verify .button").prop("disabled",!1),$("#twofa-form-verify #twofa-code").prop("disabled",!1),$("#twofa-verify-msg").html('<p class="errmsg">'+e.data.message+"</p>")},error:function(e){$("#twofa-verify-msg").html('<p class="errmsg">Error generating QR code. Please check your internet connection and try again. Status: '+e.status+", Response Text: "+e.responseText+"</p>"),$("#twofa-form-verify .button").prop("disabled",!1),$("#twofa-form-verify #twofa-code").prop("disabled",!1)}})):$("#twofa-verify-msg").html('<p class="errmsg">The code must be exactly 6 digits long.</p>')}))}));